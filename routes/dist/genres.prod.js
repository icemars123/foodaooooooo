"use strict";var Admin=require("../middleware/Admin"),Auth=require("../middleware/Auth"),_require=require("../models/Genre"),Genre=_require.Genre,validateGenre=_require.validateGenre,bodyParer=require("body-parser"),mongoose=require("mongoose"),express=require("express"),router=express.Router();router.get("/",function(e,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Genre.find().sort({name:1}));case 3:n=e.sent,r.send(n),console.log(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.status(500).send("Something failed");case 11:case"end":return e.stop()}},null,null,[[0,8]])}),router.get("/:id",function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Genre.findById(r.params.id));case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",n.status(404).send("The genre with the given ID was not found."));case 6:n.send(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n.status(500).send("Something failed");case 12:case"end":return e.stop()}},null,null,[[0,9]])}),router.post("/",[Auth,Admin],function(r,n){var t,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=validateGenre(r.body),a=t.error)return e.abrupt("return",n.status(400).send(a.details[0].message));e.next=3;break;case 3:return s=new Genre({name:r.body.name}),e.prev=4,e.next=7,regeneratorRuntime.awrap(Genre.find({name:r.body.name}));case 7:if(0<e.sent.length)return e.abrupt("return",n.status(409).send("The name already exists"));e.next=10;break;case 10:return e.next=12,regeneratorRuntime.awrap(s.save());case 12:s=e.sent,n.send(s),e.next=19;break;case 16:for(field in e.prev=16,e.t0=e.catch(4),e.t0)console.log(field.message);case 19:case"end":return e.stop()}},null,null,[[4,16]])}),router.put("/:id",function(r,n){var t,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=validateGenre(r.body),a=t.error)return e.abrupt("return",n.status(400).send(a.details[0].message));e.next=3;break;case 3:return e.prev=3,e.next=6,regeneratorRuntime.awrap(Genre.findByIdAndUpdate(r.params.id,{name:r.body.name},{new:!0}));case 6:if(s=e.sent){e.next=9;break}return e.abrupt("return",n.status(404).send("The genre with the given ID was not found."));case 9:n.send(s),e.next=15;break;case 12:for(field in e.prev=12,e.t0=e.catch(3),e.t0)console.log(field.message);case 15:case"end":return e.stop()}},null,null,[[3,12]])}),router.delete("/:id",[Auth,Admin],function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Genre.findByIdAndDelete(r.params.id));case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",n.status(404).send("The genre with the given ID was not found."));case 6:n.send(t),e.next=12;break;case 9:for(field in e.prev=9,e.t0=e.catch(0),e.t0)console.log(field.message);case 12:case"end":return e.stop()}},null,null,[[0,9]])}),module.exports=router;