"use strict";var _require=require("./Product"),Product=_require.Product,Joi=require("@hapi/joi");Joi.objectId=require("joi-objectid")(Joi);var mongoose=require("mongoose"),orderSchema=new mongoose.Schema({products:{type:Array,items:{type:JSON,properties:{product:{type:new mongoose.Schema({dishName:{type:String,required:!0,trim:!0},price:{type:Number,required:!0,trim:!0},unit:{type:String,required:!0,trim:!0}})},quantity:{type:Number,required:!0,set:function(e){return Math.round(e)},get:function(e){return Math.round(e)}}}}},date:{type:Date,default:Date.now},total:{type:Number,required:!0}}),Order=new mongoose.model("Order",orderSchema);function validateOrder(e){return Joi.object({productId:Joi.objectId().required(),quantity:Joi.number().required()}).validate(e)}function addOrder(e){this.items=e.items,this.totalQty=e.totalQty,this.totalPrice=e.totalPrice,this.add=function(e,r){var t=this.items[r];(t=t||(this.items[r]={item:e,qty:0,price:0})).qty++,t.price=t.item.price*t.qty,this.totalQty++,this.totalPrice+=t.price},this.generateArray=function(e){var r=[];for(var t in this.items)r.push(this.items[t]);return r}}exports.Order=Order,exports.orderSchema=orderSchema,exports.validateOrder=validateOrder,exports.addOrder=addOrder;