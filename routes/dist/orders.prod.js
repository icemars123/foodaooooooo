"use strict";var Auth=require("../middleware/Auth"),_require=require("../models/Product"),Product=_require.Product,_require2=require("../models/Order"),Order=_require2.Order,validateOrder=_require2.validateOrder,addOrder=_require2.addOrder,express=require("express"),router=express.Router();router.get("/",function(e,r,t){var s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Order.find());case 3:s=e.sent,a={count:s.length,orders:s},r.status(200).json({message:"Handling GET requests to /products.",response:a}),e.next=12;break;case 8:for(field in e.prev=8,e.t0=e.catch(0),e.t0.errors)console.log(e.t0.errors[field].message);t();case 12:case"end":return e.stop()}},null,null,[[0,8]])}),router.get("/:productId",function(r,t){var s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.params.productId,new addOrder(r.session.order?r.session.order:{}),e.next=4,regeneratorRuntime.awrap(Product.findById(s));case 4:if((a=e.sent)<=0)return e.abrupt("return",t.status(400).send("Invalid product."));e.next=7;break;case 7:card.add(a,a._id),t.status(200).json({message:"The Order details",orderId:r.params.orderId});case 9:case"end":return e.stop()}})}),router.post("/",Auth,function(r,t,s){var a,n,d,u,o,c,i,p,l,f,v;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],d=!(n=!0),u=void 0,e.prev=4,o=r.body.products[Symbol.iterator]();case 6:if(n=(c=o.next()).done){e.next=20;break}if(i=c.value,p=validateOrder(i),l=p.error)return e.abrupt("return",t.status(400).send(l.details[0].message));e.next=11;break;case 11:return e.next=13,regeneratorRuntime.awrap(Product.findById(i.productId));case 13:if(f=e.sent){e.next=16;break}return e.abrupt("return",t.status(400).send("Invalid product."));case 16:a.push({product:{_id:f._id,dishName:f.dishName,price:f.price,unit:f.unit},quantity:i.quantity});case 17:n=!0,e.next=6;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),d=!0,u=e.t0;case 26:e.prev=26,e.prev=27,n||null==o.return||o.return();case 29:if(e.prev=29,d)throw u;e.next=32;break;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return v=new Order({date:r.body.date,total:r.body.total,products:a}),e.prev=35,e.next=38,regeneratorRuntime.awrap(v.save());case 38:v=e.sent,t.status(201).json({order:v}),e.next=47;break;case 42:e.prev=42,e.t1=e.catch(35),console.log(e.t1),t.status(500).json({error:e.t1}),s();case 47:case"end":return e.stop()}},null,null,[[4,22,26,34],[27,,29,33],[35,42]])}),router.put("/:orderId",function(e,r,t){r.status(200).json({message:"The order was changed."})}),router.delete("/:orderId",function(e,r,t){r.status(200).json({message:"The order was deleted",orderId:e.params.orderId})}),module.exports=router;