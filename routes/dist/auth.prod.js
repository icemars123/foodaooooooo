"use strict";var config=require("config"),jwt=require("jsonwebtoken"),bcrypt=require("bcrypt"),_=require("lodash"),_require=require("../models/User"),User=_require.User,Joi=require("@hapi/joi"),csurf=require("csurf"),express=require("express"),router=express.Router();function validateRequest(e){return Joi.object({phone:Joi.string().required(),email:Joi.string().email(),password:Joi.string().pattern(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9]).{6,16}$/)}).validate(e)}router.post("/token",function(r,t,s){var n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=validateRequest(r.body),a=n.error)return e.abrupt("return",t.status(400).send(a.details[0].message));e.next=3;break;case 3:return e.prev=3,e.next=6,regeneratorRuntime.awrap(User.findOne({phone:r.body.phone}));case 6:if(o=e.sent){e.next=9;break}return e.abrupt("return",t.status(404).json({message:"Invalid phone number"}));case 9:return e.next=11,regeneratorRuntime.awrap(bcrypt.compare(r.body.password,o.password));case 11:if(e.sent){e.next=14;break}return e.abrupt("return",t.status(400).json({message:"Invalid password"}));case 14:u=o.generateAuthToken(),t.status(201).send({message:"True.",token:u}),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(3),console.log(e.t0),t.status(500).json({error:e.t0}),s();case 23:case"end":return e.stop()}},null,null,[[3,18]])}),module.exports=router;